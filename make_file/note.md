# 2. An Introduction to Makefiles

## 2.1 What a Rule Looks Like

```
target ...: prerequisites ...
	recipe
	...
	...
```

- target: 
	- the name of a file that is generated by a program; eg. executable files, object files. 
	- the name of an action to carry out, eg. 'clean' (Phony Targets).

- prerequisites: files that are used as input to create the target.

- recipe: 
	- actions that `make` carries out.
	- must put a tab character at the begining of every recipe line. It can be changed by settings the `.RECIPEPREFIX` variable to an alternate character.

- rule: tells how and when to remake certain files which are the targets of the particular rule.

## 2.2 A Simple Makefile

ref. ../makefile

## 2.3 How `make` pocesses a Makefile

By default, `make` starts with the first target.

You can overrite the default behavior using the command line, or setting the `.DEFAULT_GOAL` special variable.

1. In the simple example in 2.2, the default goal is to update the executable programe `edit`. The rule is for relinking edit.
2. But before `make` can fully process this rule, it must process the rules for the files that `edit` depends on, which in this case are the object files. Their rules say to update each object file by compling its source file. The recompiling must be done if the source file, or any of the header files named as prerequisites, is more recent than the object file, or if the object file does not exist.
3. If some other rule is not depended on by the goal, that rule is not processed, unless you tell `make` to do so, eg. `clean`.

## 2.4 Variables Make Makefiles Simpler

Variables allow a text string to be defined once and substituted in multiple places later.

```
objects = main.o kbd.o command.o display.o \
	  insert.o search.o files.o utils.o
edit: $(objects)
	cc -o edit $(objects)
```

## Letting `make` Deduce the Recipes

Implicit rules allow us to omit recipes.

eg. It is not necessary to spell out the recipe for compiling the individual C source files: it has an implicit rule for updating a `.o` file from a correspondingly named `.c` file using a `cc -c`command. it will use recipe `cc -c main.c -o main.o` to compile `main.c` into `main.o`.

```
command.o: defs.h buffer.h
```

## 2.6 Another Style of Makefile

When the objects of a makefile are created only by implicit rules, you can group entries by their prerequisites instead of by their targets.

```
$(objects): defs.h
kbd.o command.o files.o: command.h
display.o insert.o search.o files.o: buffer.h
```

# 3 Writing Makefiles

## 3.1 What Makefiles Contain

- explicit rule
- implicit rule
- variable definition
- directive
- comment
- splitting long lines
	- backslash character (`\`)
	- physical line (a line)  vs logical line (a statement)










